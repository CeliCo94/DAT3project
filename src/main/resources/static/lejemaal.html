<!doctype html>
<html lang="da">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Himmerland HERO</title>
  <link rel="stylesheet" href="/styles.css" />
</head>

<body>
    <!-- This is where the shared header is injected -->
    <aside data-include="/partials/header.html"></aside>

  <div class="layout">
    <!-- Shared menu -->
    <aside data-include="/partials/menu.html"></aside>

    <main class="content">
      <section class="card">
        <h2>Lejemål</h2>

        <!-- Button to open modal-->
         <button class="add-tenancy-btn" onclick="openTenancyModal()">+ Opret nyt lejemål</button>

         <!-- Filter by Department-->
        <div style="margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
          <label for="department-filter">Filtrer efter afdeling:</label>
          <select id="department-filter" onclick="filterByDepartment()"
          style="padding: 8px 12px; border-radius: 4px; border: 1px solid #b9c9b9; font-size: 14px; min-width: 200px;">
          <option value="">Alle afdelinger</option>
          <!-- Departments will be loaded here -->
        </select>
        <button onclick="clearFilter()" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 14px;">
          Ryd filter
        </button>
        </div>
         <!-- Modal for Create/Edit-->
          <div id="tenancy-modal" class="modal-overlay" onclick="closeModalOverlay(event)">
            <div class="modal-content" onclick="event.stopPropagation()">
              <div class="modal-header">
                <h3 id="tenancy-modal-title">Opret nyt lejemål</h3>
                <button class="close-btn" onclick="closeTenancyModal()">&times;</button>
                </div>
                <form id="tenancy-form" class="modal-form">
                  <input type="hidden" id="tenancy-id-hidden" />

                  <!-- Make ID field optional and only visible for edit mode -->
                  <label for="tenancy-id"><strong>ID:</strong> <span style="color: #999;">(genereres automatisk)</span></label>
                  <input type="text" id="tenancy-id" name="id" 
                         pattern="^[A-Za-z0-9_-]{3,32}$"
                         title="ID skal være 3-32 tegn langt og må kun indeholde bogstaver, tal og bindestreger" 
                         placeholder="Lad stå tom for automatisk generering" />

                  <label for="tenancy-meter-number"><strong>Måler nummer:</strong></label>
                  <input type="text" id="tenancy-meter-number" name="meterNumber" required />

                  <label for="tenancy-department-id"><strong>Afdeling</strong></label>
                  <select id="tenancy-department-id" name="departmentId" required>
                    <option value="">Vælg afdeling</option>
                  <!-- Departments will bo loaded here-->
                   </select>

                  <label for="tenancy-number"><strong>Lejemål nummer</strong></label>
                  <input type="text" id="tenancy-number" name="tenancyNumber" required /> 

                  <label for="tenancy-address"><strong>Adresse:</strong></label>
                  <input type="text" id="tenancy-address" name="address" required />

                  <label for="tenan-city"><strong>By:</strong></label>
                  <input type="text" id="tenancy-city" name="city" required />

                  <label for="tenancy-postal-code"><strong>Postnummer:</strong></label>
                  <input type="text" id="tenancy-postal-code" name="postalCode" required />

                  <div class="checkbox-label">
                    <input type="checkbox" id="tenancy-active" name="active" checked>
                    <label for="tenancy-active" style="margin: 0; font-weight: normal;"><strong>Aktiv</strong></label>
                  </div>
                  <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeTenancyModal()">Annuler</button>
                    <button type="submit" id="tenancy-submit-btn" class="btn btn-primary">Opret</button>
                </form>
              </div>
            </div>
          </div>

          <div class="table-wrap">
            <table class="data-table" id="lejemaal-table">
              <thead>
                <tr>
                  <th>Lejemål nr.</th>
                  <th>Måler nr.</th>
                  <th>Afdeling</th>
                  <th>Adresse</th>
                  <th>By</th>
                  <th>Postnummer</th>
                  <th>Handlinger</th>
                </tr>
              </thead>
              <tbody>
                <!-- Tenancies will be loaded here -->
              </tbody>
            </table>
          </div>
      </section>
    </main>
  </div>

  <!-- scripts -->
  <script src="/js/include-menu.js"></script>
  <script src="/js/fetchTenancies.js"></script>
</body>

</html>